{% extends "layout/index.html" %}
{% block title %} تفاصيل شركة {{ vendor.company.name }} | مواردي {% endblock %}

{% block content %}
<section class="dashboard-wrapper container">

    <div class="db-header animate__animated animate__fadeIn">
        <div class="welcome-text">
            <a href="{% url 'client_dashboard' %}" class="btn-back-circle" title="العودة للوحة التحكم">
                <i class="fas fa-arrow-right"></i>
            </a>
            
            <div class="user-avatar" style="background: var(--dark);">
                <i class="fas fa-city"></i>
            </div>
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'client_dashboard' %}">الرئيسية</a></li>
                        <li class="breadcrumb-item active">تفاصيل المورد</li>
                    </ol>
                </nav>
                <h1>{{ vendor.company.name }}</h1>
                <p>
                    <i class="fas fa-user-shield"></i> المسؤول: {{ vendor.contact_name }} | 
                    <i class="fas fa-phone"></i> {{ vendor.contact_phone }}
                </p>
            </div>
        </div>

        <div class="header-actions">
            <button class="btn-action pulse-animation">
                <i class="fas fa-file-download"></i> استخراج تقرير الأداء
            </button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-item animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
            <div class="stat-icon purple"><i class="fas fa-users"></i></div>
            <div class="stat-info">
                <span class="label">إجمالي العمالة</span>
                <span class="count">{{ workers_count }}</span>
            </div>
            <div class="stat-progress"><div class="bar" style="width: 100%; background: #7c3aed;"></div></div>
        </div>

        <div class="stat-item animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
            <div class="stat-icon orange"><i class="fas fa-plane"></i></div>
            <div class="stat-info">
                <span class="label">عمال في إجازة</span>
                <span class="count">{{ vacation_count }}</span>
            </div>
            <div class="stat-progress"><div class="bar" style="width: 20%; background: #ea580c;"></div></div>
        </div>

        <div class="stat-item animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
            <div class="stat-icon green"><i class="fas fa-check-double"></i></div>
            <div class="stat-info">
                <span class="label">على رأس العمل</span>
                <span class="count">{{ active_count }}</span>
            </div>
            <div class="stat-progress"><div class="bar" style="width: 80%; background: #16a34a;"></div></div>
        </div>
    </div>

    <div class="row-grid">
        <div class="data-card animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
            <div class="card-header">
                <h3><i class="fas fa-id-card"></i> قائمة العمالة التابعة</h3>
                <div class="card-tools">
                    <span class="badge" style="background: #f1f5f9; color: var(--dark);">العدد: {{ workers.count }}</span>
                </div>
            </div>

            <div class="table-responsive">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>العامل</th>
                            <th>المسمى الوظيفي</th>
                            <th>الحالة</th>
                            <th>تاريخ المباشرة</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for worker in workers %}
                        <tr>
                            <td class="id-cell">
                                <strong>{{ worker.full_name }}</strong><br>
                                <small class="text-muted">إقامة: {{ worker.iqama_number }}</small>
                            </td>
                            <td>{{ worker.job_title }}</td>
                            <td>
                                <span class="badge {% if worker.status == 'active' %}approved-light{% elif worker.status == 'vacation' %}pending-light{% else %}rejected-light{% endif %}">
                                    <i class="fas fa-circle" style="font-size: 8px;"></i> {{ worker.get_status_display }}
                                </span>
                            </td>
                            <td>{{ worker.joined_at|date:"Y-m-d" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 30px; color: #94a3b8;">
                                <i class="fas fa-info-circle"></i> لا يوجد عمال مسجلين لهذه الشركة حالياً.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="data-card animate__animated animate__fadeInUp" style="animation-delay: 0.5s;">
            <div class="card-header">
                <h3><i class="fas fa-chart-pie"></i> ملخص الحالات</h3>
            </div>
            
            <div class="status-summary-list">
                <div class="summary-item">
                    <span><i class="fas fa-circle" style="color: #10b981;"></i> نشط</span>
                    <strong>{{ active_count }}</strong>
                </div>
                <div class="summary-item">
                    <span><i class="fas fa-circle" style="color: #f59e0b;"></i> إجازة</span>
                    <strong>{{ vacation_count }}</strong>
                </div>
                <div class="summary-item">
                    <span><i class="fas fa-circle" style="color: #ef4444;"></i> أخرى</span>
                    <strong>{{ other_count }}</strong>
                </div>
                <hr style="border: 0; border-top: 1px solid #f1f5f9; margin: 10px 0;">
                <div class="summary-item" style="background: #eff6ff; border: 1px dashed #3b82f6;">
                    <span style="color: #3b82f6; font-weight: bold;">إجمالي العمالة</span>
                    <strong style="color: #3b82f6;">{{ workers_count }}</strong>
                </div>
            </div>
        </div>
    </div>

</section>

<style>
    :root {
        --primary: #10b981;
        --primary-dark: #059669;
        --dark: #1e293b;
        --light-bg: #f8fafc;
    }

    .dashboard-wrapper { padding: 40px 0; direction: rtl; }

    /* الهيدر وزر الرجوع */
    .db-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
    .welcome-text { display: flex; align-items: center; gap: 15px; }
    
    .btn-back-circle {
        width: 45px; height: 45px;
        background: white; border: 1px solid #e2e8f0;
        border-radius: 50%; display: flex;
        align-items: center; justify-content: center;
        color: var(--dark); text-decoration: none;
        transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    }
    .btn-back-circle:hover { background: var(--dark); color: white; transform: translateX(10px); }

    .user-avatar { width: 60px; height: 60px; color: white; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

    /* Breadcrumbs */
    .breadcrumb { background: none; padding: 0; margin: 0 0 5px 0; display: flex; list-style: none; gap: 8px; font-size: 13px; }
    .breadcrumb-item a { color: var(--primary); text-decoration: none; }
    .breadcrumb-item.active { color: #94a3b8; }
    .breadcrumb-item + .breadcrumb-item::before { content: " / "; color: #cbd5e1; }

    .db-header h1 { font-size: 24px; font-weight: 800; margin: 0; color: var(--dark); }
    .db-header p { margin: 5px 0 0 0; color: #64748b; font-size: 14px; }

    /* الأزرار والإحصائيات */
    .btn-action { background: var(--primary); color: white; padding: 12px 25px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
    .btn-action:hover { background: var(--primary-dark); transform: translateY(-3px); }

    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px; }
    .stat-item { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); position: relative; }
    .stat-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 15px; }
    
    .purple { background: #f5f3ff; color: #7c3aed; }
    .orange { background: #fff7ed; color: #ea580c; }
    .green { background: #f0fdf4; color: #16a34a; }

    .stat-info .count { font-size: 30px; font-weight: 800; color: var(--dark); }
    .stat-progress { height: 6px; background: #f1f5f9; border-radius: 10px; margin-top: 15px; overflow: hidden; }
    .stat-progress .bar { height: 100%; border-radius: 10px; }

    /* الشبكة والجداول */
    .row-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }
    .data-card { background: white; border-radius: 24px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.02); }
    .card-header { display: flex; justify-content: space-between; margin-bottom: 25px; align-items: center; }
    .card-header h3 { font-size: 18px; font-weight: 700; color: var(--dark); margin: 0; }
    
    .modern-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
    .modern-table th { padding: 15px; text-align: right; color: #94a3b8; font-size: 13px; }
    .modern-table td { padding: 18px 15px; background: #f8fafc; border: none; font-size: 14px; }
    .modern-table tr td:first-child { border-radius: 0 15px 15px 0; }
    .modern-table tr td:last-child { border-radius: 15px 0 0 15px; }

    .status-summary-list { display: flex; flex-direction: column; gap: 12px; }
    .summary-item { display: flex; justify-content: space-between; padding: 15px; background: #f8fafc; border-radius: 12px; align-items: center; }

    /* البادجات */
    .badge { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 5px; width: fit-content; }
    .approved-light { background: #dcfce7; color: #15803d; }
    .pending-light { background: #fef3c7; color: #92400e; }
    .rejected-light { background: #fee2e2; color: #b91c1c; }

    /* حركات Animation */
    .pulse-animation { animation: pulse 2s infinite; }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
        70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
        100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }

    @media (max-width: 992px) { .row-grid { grid-template-columns: 1fr; } }
    @media (max-width: 768px) { .db-header { flex-direction: column; text-align: center; gap: 20px; } .welcome-text { flex-direction: column; } }
</style>
{% endblock %}